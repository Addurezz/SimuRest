@startuml
'https://plantuml.com/class-diagram

top to bottom direction

package "Runtime" {
    class SimuServer {
        - SimuServer : _server
        - RequestHandler: _handler
        - Router : _router
        - ResponseWriter : _writer
        - HttpListener : _listener
        
        + SimuServer(RequestHandler : handler, Router : router)
        + AddRouteRule(RouteRule routeRule) : void
    }
    
    class Router {
        + RouteTable : Table
    
        + Handle(SimuRequest : request) : SimuResponse
    }
    
    class RouteTable {
        + List<RouteRule> Routes
        
        + Match(SimuRequest : request) : RouteRule
    }
    
    class Route {
        + HttpMethod : Method
        + string : Path
        
        + Route(HttpMethod : method, string : path)
    }
    
    class RouteRule {
        + Route : Route
        + func<SimuRequest, SimuResponse> Handler
    }
    
    
    class SimuRequest {
        + string : Path
        + HttpMethod : Method
    }
    
    class RequestHandler {
        - Router : _router
        - ResponseWriter : _writer
    
        + Handle(HttpListenerContext context) : void
        + Parse(HttpListenerContext ctx) : SimuRequest
        + ProcessRequest(SimuRequest : request) : SimuResponse
    }
    
    class ResponseWriter {
        + Write(HttpListenerContext : ctx, SimuResponse response) : void
    }
    
    class SimuResponse {
        + int : StatusCode
        + string : Body
        
        + SimuResponse(int : status, string : body)
    }
}

package "Builder API" {
    class SimuServerBuilder {
        + SimuServer : Server
        + Setup(HttpMethod : method, string path) : RouteRuleBuilder
    }
    
    class RouteRuleBuilder {
        - SimuServerBuilder : _serverBuilder
        - RouteRule : _routeRule
        
        + Responds(func<Request, Response> func) : RouteRuleBuilder
        + End() : SimuServerBuilder
    }
}

SimuServer --* SimuServerBuilder
RouteRuleBuilder *-- SimuServerBuilder

RouteRuleBuilder *-- RouteRule
RouteRule *-- Route

RequestHandler *-- Router
Router *-- RouteTable
RequestHandler *-- ResponseWriter

SimuServer *-- RequestHandler
SimuServer *-- Router

RouteTable o-- RouteRule


@enduml